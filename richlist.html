<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ron's Alephium Richlist</title>

<style>
:root {
  --bg-main: #dcffe9;
  --card-bg: rgba(255,255,255,.6);
  --border: rgba(0,0,0,.08);
  --text: #14532d;
  --muted: rgba(20,83,45,.65);
  --accent: #22c55e;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  min-height: 100vh;
  font-family: Inter, system-ui, sans-serif;
  background: var(--bg-main);
  color: var(--text);
}

.banner {
  background: rgba(0,0,0,.06);
  padding: 6px 12px;
  font-size: .8rem;
  text-align: center;
}

.container {
  min-height: calc(100vh - 32px);
  max-width: 1100px;
  margin: 0 auto;
  padding: 20px 14px 60px;
}

.header {
  display: flex;
  align-items: center;
  gap: 12px;
}

.header img {
  width: 44px;
  height: 44px;
  border-radius: 50%;
}

h1 { margin: 0; font-size: 1.8rem; }

.subtitle {
  font-size: .9rem;
  color: var(--muted);
}

.search {
  margin: 18px 0;
  position: relative;
}

.search input {
  width: 100%;
  padding: 12px 14px;
  border-radius: 14px;
  border: 1px solid var(--border);
  font-size: .95rem;
}

.results {
  position: absolute;
  top: 105%;
  left: 0;
  right: 0;
  background: white;
  border-radius: 12px;
  border: 1px solid var(--border);
  max-height: 260px;
  overflow: auto;
  z-index: 5;
}

.result {
  padding: 10px 14px;
  cursor: pointer;
}

.result:hover {
  background: rgba(0,0,0,.05);
}

.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
  gap: 12px;
  margin-bottom: 18px;
}

.stat {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 14px;
}

.stat-label {
  font-size: .75rem;
  color: var(--muted);
}

.stat-value {
  font-size: 1.15rem;
  font-weight: 700;
}

.card {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 18px;
  overflow: hidden;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 12px;
  font-size: .88rem;
}

th {
  text-align: left;
  color: var(--muted);
}

.balance, .percent {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

.rank { width: 52px; font-weight: 700; }

.address a {
  font-family: monospace;
  color: #166534;
  text-decoration: none;
}

.badge {
  margin-left: 6px;
  font-size: .7rem;
}

.loading {
  padding: 40px;
  text-align: center;
  color: var(--muted);
}

footer {
  margin-top: 22px;
  font-size: .75rem;
  text-align: center;
  color: var(--muted);
}

@media (max-width: 640px) {
  th.address-col { width: 40%; }
  .address a { font-size: .75rem; }
  th.balance, th.percent { font-size: .7rem; }
}
</style>
</head>

<body>

<div class="banner">
  ‚ù§Ô∏è Donate ALPH: <code>18dQPP6LpNqCm9upKvqi6YTjR4W7X2xF5KghFCFtGEcYM</code>
</div>

<div class="container">

  <div class="header">
    <img id="logo" />
    <div>
      <h1 id="title">Ron's Alephium Richlist</h1>
      <div class="subtitle" id="subtitle"></div>
    </div>
  </div>

  <div class="search">
    <input id="search" placeholder="Search tokens‚Ä¶" />
    <div id="results" class="results" style="display:none;"></div>
  </div>

  <div class="stats">
    <div class="stat">
      <div class="stat-label">Holders</div>
      <div id="statHolders" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-label">Total Supply</div>
      <div id="statSupply" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-label">Top 10 Concentration</div>
      <div id="statTop10" class="stat-value">‚Äî</div>
    </div>
  </div>

  <div class="card">
    <div id="status" class="loading">Loading rich list‚Ä¶</div>
    <table id="table" style="display:none;">
      <thead>
        <tr>
          <th class="rank">#</th>
          <th class="address-col">Address</th>
          <th class="balance">Balance</th>
          <th class="percent">% Owned</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <footer>
    Alephium APIs update roughly once per day
  </footer>

</div>

<script>
const TOKEN_LIST =
  "https://raw.githubusercontent.com/alephium/token-list/master/tokens/mainnet.json";

const TOKEN_API =
  "https://backend.mainnet.alephium.org/tokens/holders/token/";

const ALPH_API =
  "https://api-richlist.alephium.notrustverify.ch/addresses";

const EXPLORER = "https://explorer.alephium.org/addresses/";

let TOKENS = [];

const formatAmount = n =>
  n < 0.001 ? "<0.001" :
  n >= 1e9 ? (n/1e9).toFixed(2)+"b" :
  n >= 1e6 ? (n/1e6).toFixed(2)+"m" :
  n >= 1e3 ? (n/1e3).toFixed(1)+"k" :
  n.toFixed(3);

const whale = p => p >= 5 ? "üêã" : p >= 1 ? "ü¶à" : p >= .1 ? "üê¨" : "";

async function init() {
  const res = await fetch(TOKEN_LIST);
  const json = await res.json();
  TOKENS = json.tokens;

  loadFromURL();
}

function loadFromURL() {
  const t = new URLSearchParams(location.search).get("token") || "ALPH";
  if (t === "ALPH") loadAlph();
  else loadToken(t);
}

async function loadAlph() {
  document.getElementById("logo").src =
    "https://raw.githubusercontent.com/alephium/token-list/master/logos/ALPH.png";
  document.getElementById("subtitle").textContent = "Native coin";

  const res = await fetch(`${ALPH_API}?page=1&amount=100&sort=balance&order=desc`);
  const json = await res.json();

  const rows = json.addresses.map(a => ({
    address: a.address,
    balance: a.balance / 1e18,
    name: a.type || ""
  }));

  render(rows, rows.reduce((s,x)=>s+x.balance,0), true);
}

async function loadToken(id) {
  const token = TOKENS.find(t => t.id === id);
  if (!token) return;

  document.getElementById("logo").src = token.logoURI;
  document.getElementById("subtitle").textContent = token.name;

  const res = await fetch(`${TOKEN_API}${id}?limit=100&page=1`);
  const json = await res.json();

  const rows = json
    .filter(h => h.balance > 0)
    .map(h => ({
      address: h.address,
      balance: h.balance / Math.pow(10, token.decimals)
    }));

  const total = rows.reduce((s,x)=>s+x.balance,0);
  render(rows, total, false);
}

function render(rows, total, alph) {
  rows.sort((a,b)=>b.balance-a.balance);

  document.getElementById("statHolders").textContent = rows.length;
  document.getElementById("statSupply").textContent = formatAmount(total);

  const top10 = rows.slice(0,10).reduce((s,x)=>s+x.balance,0);
  document.getElementById("statTop10").textContent =
    ((top10/total)*100).toFixed(2)+"%";

  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  rows.forEach((r,i)=>{
    const p = (r.balance/total)*100;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="rank">#${i+1}</td>
      <td class="address">
        <a href="${EXPLORER}${r.address}" target="_blank"
           title="${r.balance}">
          ${r.address.slice(0,6)}‚Ä¶${r.address.slice(-4)}
        </a>
        <span class="badge">${whale(p)}</span>
        ${alph && r.name ? `<span class="badge">${r.name}</span>` : ""}
      </td>
      <td class="balance" title="${r.balance}">
        ${formatAmount(r.balance)}
      </td>
      <td class="percent">${p.toFixed(2)}%</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("status").style.display = "none";
  document.getElementById("table").style.display = "table";
}

document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  const box = document.getElementById("results");
  box.innerHTML = "";

  const results = [
    { symbol:"ALPH", name:"Alephium (Native)", id:"ALPH" },
    ...TOKENS.filter(t =>
      t.symbol.toLowerCase().includes(q) ||
      t.name.toLowerCase().includes(q)
    )
  ].slice(0,10);

  results.forEach(r=>{
    const div = document.createElement("div");
    div.className = "result";
    div.textContent = `${r.symbol} ‚Äî ${r.name}`;
    div.onclick = ()=>{
      history.pushState({}, "", `?token=${r.id}`);
      box.style.display = "none";
      r.id === "ALPH" ? loadAlph() : loadToken(r.id);
    };
    box.appendChild(div);
  });

  box.style.display = results.length ? "block" : "none";
});

init();
</script>

</body>
</html>
